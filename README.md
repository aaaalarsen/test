# チャットボットシステム

configuration.jsonから変換されたenterprise級チャットボットシステムです。元の業務フローを完全に再現し、動的条件分岐、入力値検証、確認画面表示などの高度な機能を実装しています。

## ファイル構成

### コアファイル
- `index.html` - メインのHTMLファイル
- `styles.css` - チャットボット用CSS（レスポンシブ、アニメーション付き）
- `main.js` - メインアプリケーション（UI統合）
- `chatbot-engine.js` - チャットボットエンジン（状態管理・条件評価）

### 変換プログラム
- `converter.js` - 基本変換プログラム
- `improved-converter.js` - 改善版変換プログラム  
- `detailed-converter.js` - **詳細変換プログラム（実装版）**
- `embedded-config.js` - 埋め込み設定データ（CORS回避）

### 設定・ドキュメント
- `configuration.json` - 元の設定ファイル
- `start-server.py` - ローカルHTTPサーバー（CORS問題解決）
- `system_documentation.md` - **システム設計書（図表付き）**
- `minimal_improvement_rationale.md` - **改善案の詳細解説**

## 使用方法

### 1. 基本的な起動（推奨）
**CORSエラー回避のため、ローカルサーバーを使用：**
```bash
python start-server.py
```
ブラウザで http://localhost:8000 にアクセス

### 2. 直接ファイルを開く場合
1. ブラウザでindex.htmlを開く
2. 「テストデータで開始」ボタンをクリック
3. CORSエラーが発生した場合、自動的にフォールバックデータを使用

### 2. カスタム設定ファイルの使用
1. 「ファイルを選択」からconfiguration.jsonファイルを選択
2. 「設定を変換してチャット開始」ボタンをクリック

### 3. デバッグ機能
- `Ctrl+D` - デバッグパネルの表示切替
- `Ctrl+R` - チャットリセット（最初から開始）

## 実装されたフロー

### 完全な業務フロー（15画面）
1. **言語選択** - 日本語/English/中文（動的選択肢）
2. **取引種別選択** - 預入/払出/振込（動的選択肢）

#### 預入フロー
3. **預入金額入力** → 10. **預入金額確認** → 100. **手続き完了**

#### 払出フロー  
4. **払出金額入力** → **金額制限チェック**
   - ≤20万円: 11. **払出金額確認** → 100. **手続き完了**
   - >20万円: 98. **手続き不可**

#### 振込フロー（最も複雑）
5. **振込先国確認** → **国別分岐**
   - 日本: 6. **金融機関選択**
   - その他: 99. **手続き不可**
6. **金融機関選択** → **金融機関別分岐** 
   - 既存金融機関: 8. **支店検索方法選択**
   - その他: 7. **金融機関検索** → 8. **支店検索方法選択**
8. **支店検索方法選択** → **検索方法別分岐**
   - 支店名: 9. **支店名検索**
   - 支店コード: 12. **支店コード検索**
9/12. **支店検索** → 13. **口座番号入力** → 14. **振込金額入力** → **金額制限チェック**
   - ≤20万円: 15. **振込内容確認** → 100. **手続き完了**  
   - >20万円: 97. **手続き不可**

### 高度な機能
- **動的選択肢生成** - codeDefinitionsから自動生成
- **入力値検証** - 数値範囲、文字パターン、必須チェック
- **条件分岐** - 金額制限、国別制限等のビジネスルール
- **確認画面** - 通貨フォーマット、コード変換表示
- **エラーハンドリング** - 複数種類のエラー画面

## 技術仕様

### 変換機能（3段階の進化）
- **converter.js** - 基本的な変換機能
- **improved-converter.js** - 改善されたワークフロー解析
- **detailed-converter.js** - **完全な手動フロー構築（実装版）**

### チャットボットエンジン（高度な機能）
- **状態管理** - 現在画面、変数、履歴の完全追跡
- **条件分岐処理** - GREATER, LESS_EQUALS, EQUALS等の演算子
- **動的選択肢生成** - codeDefinitionsからの自動生成
- **入力値検証** - 型、範囲、パターン、必須項目チェック
- **フォーマット処理** - 通貨、コード変換、テキスト表示
- **エラーハンドリング** - 複数レベルの例外処理

### UI機能（モダンデザイン）
- **レスポンシブデザイン** - PC/タブレット/スマホ対応
- **タイピングインジケーター** - リアルなチャット体験
- **スムーズなアニメーション** - slideIn, fadeIn効果
- **デバッグパネル** - 開発者向け状態監視ツール

### 出力機能
- **JSON出力** - 変換結果の自動ダウンロード（`converted_chat_data.json`）
- **状態出力** - 実行時状態のエクスポート機能
- **ログ出力** - 詳細なデバッグ情報

## カスタマイズ

### 新しい取引タイプの追加
1. configuration.jsonのcodedefに新しい取引種別を追加
2. domainWorkFlowsに対応するワークフローを定義
3. 変換プログラムが自動的に処理

### UI のカスタマイズ
- `styles.css`でデザインを変更
- カラーテーマ、フォント、レイアウトを調整可能

### 機能拡張
- `chatbot-engine.js`で新しいノードタイプを追加
- `main.js`でUI機能を拡張

## 動作確認項目

- [ ] 言語選択から取引種別選択への遷移
- [ ] 各取引タイプの固有フロー
- [ ] 金額制限による分岐処理
- [ ] 入力値検証
- [ ] エラー画面の表示
- [ ] 正常完了画面の表示
- [ ] デバッグ機能の動作

## 制限事項

- ローカルファイルアクセスのため、一部ブラウザで制限あり
- 複雑な分岐条件は簡略化されている場合あり
- 実際の業務システムとの連携は未実装

## 開発者向け

### デバッグ方法
1. デバッグパネルで現在の状態を確認
2. ブラウザの開発者ツールでログを確認
3. `jumpToScreen(画面番号)`で特定画面に移動

### 拡張方法
1. 新しいノードタイプを`chatbot-engine.js`に追加
2. 対応するUI処理を`main.js`に実装
3. 必要に応じて`converter.js`の変換ロジックを修正